bathhouse:
  climate:
    - platform: generic_thermostat
      name: bathhouse_thermostat
      heater: switch.protherm
      target_sensor: sensor.bathhouse_climate_temperature
      min_temp: 5
      max_temp: 30
      target_temp_step: 1
      precision: 0.1
      initial_hvac_mode: "heat"
      keep_alive:
        minutes: 3
      away_temp: 5
      comfort_temp: 24
      sleep_temp: 22
      eco_temp: 16

  input_number:
    bathhouse_drying_time:
      min: 8
      max: 48
      initial: 24
      step: 2
      mode: slider
      icon: mdi:timer

    # bathhouse_target_temperature_after_drying:
    #   min: 5
    #   max: 30
    #   initial: 5
    #   step: 1
    #   mode: slider
    #   icon: mdi:thermometer

  timer:
    bathhouse_drying_timer:
      duration: "24:00:00"

  scene:
    - name: off_light
      entities:
        light.corridor_lamp_1: off
        light.corridor_lamp_2: off

    - id: "cleaning"
      name: cleaning
      icon: mdi:white-balance-sunny
      entities:
        light.bathhouse_room_main:
          state: "on"
        light.bathhouse_room_backlight:
          state: "on"
        light.bathhouse_bath:
          state: "on"
        light.bathhouse_steam_lamps:
          state: "on"
        light.bathhouse_steam_lamps_controller:
          brightness: 255
          state: "on"
        light.bathhouse_steam_stove:
          state: "on"
        light.bathhouse_steam_stove_controller:
          brightness: 255
          state: "on"
        light.bathhouse_steam_bench:
          state: "on"
        light.bathhouse_steam_bench_controller:
          brightness: 255
          state: "on"

    - id: "steaming"
      name: steaming
      icon: mdi:hot-tub
      entities:
        light.bathhouse_room_main:
          state: "off"
        light.bathhouse_room_backlight:
          state: "on"
        light.bathhouse_bath:
          state: "on"
        light.bathhouse_steam_lamps:
          state: "off"
        light.bathhouse_steam_lamps_controller:
          state: "off"
        light.bathhouse_steam_stove:
          state: "on"
        light.bathhouse_steam_stove_controller:
          brightness: 2
          state: "on"
        light.bathhouse_steam_bench:
          state: "on"
        light.bathhouse_steam_bench_controller:
          brightness: 2
          state: "on"

  input_select:
    bathhouse_scenes:
      name: bathhouse_scenes
      options:
        - steaming
        - cleaning

  script:
    bathhouse_drying_on:
      sequence:
        - service: climate.turn_off
          target:
            entity_id: climate.bathhouse_thermostat
        - delay: "00:00:01"
        - service: switch.turn_on
          target:
            entity_id: switch.protherm

    bathhouse_drying_timer_finish:
      sequence:
        - service: timer.finish
          target:
            entity_id: timer.bathhouse_drying_timer

    bathhouse_drying_off:
      sequence:
        - service: climate.turn_on
          target:
            entity_id: climate.bathhouse_thermostat
        # - service: climate.set_temperature
        #   target:
        #     entity_id: climate.bathhouse_thermostat
        #   data:
        #     temperature: "{{ states('input_number.bathhouse_target_temperature_after_drying') | int }}"

  automation:
    - alias: "bathhouse_drying_timer_restart"
      id: "bathhouse_drying_timer_restart"
      triggers:
        - trigger: state
          entity_id:
            - script.bathhouse_drying_on
      actions:
        - action: timer.start
          data:
            duration: "{{ states('input_number.bathhouse_drying_time') | int * 60 * 60 }}"
          target:
            entity_id: timer.bathhouse_drying_timer

    - alias: "bathhouse_drying_off"
      id: "bathhouse_drying_off"
      triggers:
        - trigger: event
          event_type: timer.finished
          event_data:
            entity_id: timer.bathhouse_drying_timer
      actions:
        - action: script.turn_on
          target:
            entity_id: script.bathhouse_drying_off

    - id: apply_bathhouse_scene
      alias: apply_bathhouse_scene
      initial_state: true
      triggers:
        - trigger: state
          entity_id: input_select.bathhouse_scenes
      actions:
        - action: scene.turn_on
          target:
            entity_id: scene.{{trigger.to_state.state}}
          data:
            transition: 2.5
